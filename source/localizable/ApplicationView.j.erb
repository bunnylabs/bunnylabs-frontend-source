@import <Foundation/Foundation.j>
@import <AppKit/AppKit.j>

@import "ApplicationInfo.j"
@import "IconCollectionView.j"

// Import the applications
<% application_list().each do |appname| %>
@import "Applications/<%= appname %>/<%= appname %>.j"
<% end %>

@implementation ApplicationView : CPView
{
	CPCollectionView iconsView @accessors;
	CPScrollView scrollView;
}

-(id)init
{
	self = [super initWithFrame:CGRectMake(0,0,500,500)];
	if (self)
	{
        scrollView = [[CPScrollView alloc] initWithFrame:[self frame]];
        [scrollView setAutoresizingMask:CPViewWidthSizable | CPViewHeightSizable];
        [scrollView setAutohidesScrollers:YES];

		iconsView = [[IconCollectionView alloc] initWithFrame:[self frame]];
        [iconsView setAutoresizingMask: CPViewWidthSizable | CPViewHeightSizable];

        [self setAutoresizingMask: CPViewWidthSizable | CPViewHeightSizable];

        var items = [];

        // Add applications to the list
		<% application_list().each do |appname| %>
		{
			var appBundle = [CPBundle bundleWithPath:"Applications/<%= appname %>"];

			var app = [[<%= appname %> alloc] initWithBundle:appBundle];

	        var file = [appBundle pathForResource:@"Images/icon.png"];

			var icon = [[CPImage alloc] initWithContentsOfFile:file
														size:CGSizeMake(200.0, 200.0)];

			var item = [ApplicationInfo applicationInfoOf:app withIcon:icon withBundle:appBundle];

			items.push(item);
		}
		<% end %>
                    

        [iconsView setContent:items];

        [scrollView setDocumentView:iconsView];
		[self addSubview:scrollView];

	}
	return self;
}

@end
